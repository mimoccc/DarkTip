<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>DarkTip - Test Suite</title>
	<style type="text/css">
		
		* {
			padding: 0;
			margin: 0;
		}
		
		body {
			font-family: sans-serif;
			font-size: 12px;
			line-height: 150%;
		}
		
		div.testing {
			border: 2px solid #999;
			background-color: #eee;
			margin: 10px;
			padding: 2px 4px;
		}
		
	</style>
</head>
<body>
	
	<p>
		Testing dust.js
	</p>
	
	<div class="testing" id="testing-1"></div>
	<div class="testing" id="testing-2"></div>
	<div class="testing" id="testing-3"></div>
	<div class="testing" id="testing-4"></div>
	<div class="testing" id="testing-5"></div>
	<div class="testing" id="testing-6"></div>
	<div class="testing" id="testing-7"></div>
	<div class="testing" id="testing-8"></div>
	<div class="testing" id="testing-9"></div>
	
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script type="text/javascript" src="dustjs/dust-full-0.3.0.min.js"></script>
	<script type="text/javascript">
		
		var base = dust.makeBase({
			't': function(chunk, context, bodies, params) {
				return chunk.map(function(chunk) {
					chunk.render(bodies.block, context);
					if(typeof i18n['de_de'][chunk.data] !== 'undefined') {
						dust.renderSource(i18n['de_de'][chunk.data], base.push(params), function(err, out) {
							chunk.data = out;
							chunk.end();
						});
					} else {
						chunk.data = 'Missing translation: "' + chunk.data + '"';
						chunk.end();
					}
				});
			},
		});
		
		var i18n = {
			'en_us': {
				'world': 'world',
				'world.39': 'another world',
				'something': 'something',
				'test': 'world.29'
			},
			'de_de': {
				'world': 'Welt',
				'world.39': 'Ein andere Welt, {name}',
				'something': 'etwas',
				'test': 'world.39'
			}
		};
		
		var data = {
			'self': {
				'name': 'dsitc'
			},
			'user': {
				'firstname': 'Eric',
				'lastname': 'Zamboni',
				'age': 39,
				'mood': 'great'
			},
			'tags': ['super', 'great', 'awesome', 'spectacular', 'unbelieveable', 'sleek']
		};
		
		dust.loadSource(dust.compile(
			'{sayHello} {user.firstname}, I hope you are feeling {user.mood}.',
			'greeting'
		));
		
		dust.loadSource(dust.compile(
			'This is a header!<br /><br />{>greeting/}<br /><br />That\'s all for now, {self.name}!',
			'header'
		));
		
		dust.loadSource(dust.compile(
			'{?tags}<div class="taglist">{#tags}{.}{@sep}, {/sep}{/tags}</div>{:else}<div class="taglist empty">No tags!</div>{/tags}',
			'taglist'
		));
		
		dust.loadSource(dust.compile(
			'"world" on "de_de" is: {#t name=self.name}world.{user.age}{/t}, and this is missing: {#t}whatever.it.is{/t}',
			'i18n'
		));
		
		dust.render('greeting', base.push(data), function(err, out) { jQuery('#testing-1').html(out); });
		dust.render('header',   base.push(data), function(err, out) { jQuery('#testing-2').html(out); });
		dust.render('taglist',  base.push(data), function(err, out) { jQuery('#testing-3').html(out); });
		dust.render('i18n',     base.push(data), function(err, out) { jQuery('#testing-4').html(out); });
		
	</script>
</body>
</html>